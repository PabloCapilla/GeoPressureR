<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="GeoPressureR">
<title>Probability aggregation • GeoPressureR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Probability aggregation">
<meta property="og:description" content="GeoPressureR">
<meta property="og:image" content="https://raphaelnussbaumer.com/GeoPressureR/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">GeoPressureR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-part-pressure">Part 1: Pressure</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-part-pressure">
    <a class="dropdown-item" href="../articles/labelling-tracks.html">1. Labelling Tracks</a>
    <a class="dropdown-item" href="../articles/pressure-map.html">2. Pressure Map</a>
    <a class="dropdown-item" href="../articles/light-map.html">3. Light Map</a>
    <a class="dropdown-item" href="../articles/probability-aggregation.html">Probability Aggregation</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-part-trajectory">Part 2: Trajectory</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-part-trajectory">
    <a class="dropdown-item" href="../articles/preparing-data.html">1. Preparing Data</a>
    <a class="dropdown-item" href="../articles/basic-graph.html">2. Basic Graph</a>
    <a class="dropdown-item" href="../articles/wind-graph.html">3. Wind Graph</a>
    <a class="dropdown-item" href="../articles/gridded-gibbs.html">Gridded Gibbs</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Rafnuss/GeoPressureTemplate#readme">Start your Study</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Rafnuss/GeoPressureR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="probability-aggregation_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Probability aggregation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Rafnuss/GeoPressureR/blob/HEAD/vignettes/probability-aggregation.Rmd" class="external-link"><code>vignettes/probability-aggregation.Rmd</code></a></small>
      <div class="d-none name"><code>probability-aggregation.Rmd</code></div>
    </div>

    
    
<p>At the core of GeoPressure, we try to estimate the position of the bird based on a pressure mismatch of the geolocator and a weather reanalysis dataset (<a href="https://www.ecmwf.int/en/forecasts/datasets/reanalysis-datasets/era5" class="external-link">ERA5</a>). A major challenge in this process is the transformation of map of errors (mismatch) into a probability.</p>
<p>In this vignette, we will explore this challenge, look at the theory behind it and explore possible solution using Great Reed Warbler (18IC) as an example.</p>
<div class="section level2">
<h2 id="problem-presentation">Problem presentation<a class="anchor" aria-label="anchor" href="#problem-presentation"></a>
</h2>
<p>For each stationary period, we estimate the probability of the position <span class="math inline">\(\textbf{x}\)</span> of the bird based on a pressure timeseries measured by the geolocator <span class="math inline">\(P_{gl}[t] \quad \forall t \in [1,\ldots,n]\)</span>, which in a Bayesian framework can be written as, <span class="math display">\[p(\textbf{x}\mid P_{gl}[1],\ldots,P_{gl}[n]) \propto p(P_{gl}[1],\ldots,P_{gl}[n] \mid \textbf{x}) p(\textbf{x}).\]</span></p>
<p>We are interested here in determining the likelihood term <span class="math inline">\(p(P_{gl} \mid \textbf{x})\)</span> which represents the probability of observing the timeseries <span class="math inline">\(P_{gl}\)</span> knowing that the bird is at location <span class="math inline">\(\textbf{x}\)</span>. To quantify this probability, we look at the mismatch between <span class="math inline">\(P_{gl}\)</span> and the pressure timeseries of the ERA5 database <span class="math inline">\(P_{ERA5}(\textbf{x})\)</span> extracted at location <span class="math inline">\(\textbf{x}\)</span>. We can reformulate the likelihood as as a probability function <span class="math inline">\(f\)</span> of an error term <span class="math inline">\(\varepsilon(\textbf{x})\)</span> which measures a distance between <span class="math inline">\(P_{gl}\)</span> and <span class="math inline">\(P_{ERA5}(\textbf{x})\)</span> <span class="math display">\[p(P_{gl} \mid \textbf{x}) = f(\varepsilon[1],\ldots,\varepsilon[n])\]</span></p>
<p>This formulation of the problem helps us to split our problem in two: first defining an error term <span class="math inline">\(\varepsilon[t]\)</span> and secondly defining the likelihood function <span class="math inline">\(f\)</span>.</p>
</div>
<div class="section level2">
<h2 id="error-term">Error term<a class="anchor" aria-label="anchor" href="#error-term"></a>
</h2>
<p>In most cases, we would expect to measure the error term with a simple difference <span class="math inline">\(P_{ERA5}(\textbf{x})[t]-P_{gl}[t].\)</span> However, within a ERA5 grid cell of 9-30km, we can expect a wide range of altitude at which the bird can be located. As such any offset between the two timeseries might be due to nothing more than a difference of altitude.</p>
<p>To solve this issue, we remove the mean pressure difference, essentially ignoring the absolute value of pressure (and altitude) such that the error term only quantify the mismatch of the temporal variation, <span class="math display">\[\varepsilon[t] = \left( P_{ERA5}(\textbf{x})[t]-P_{gl}[t]\right) - \left( \frac{1}{n}\sum_{i=1}^{n} P_{ERA5}(\textbf{x})[i]-P_{gl}[i] \right) .\]</span></p>
<p>This way of building the error term has some important consequences. A timeseries of only one datapoint will always yield zero error at all locations, resulting in an equally probable map. As the number of datapoints increases, the error term will become more and more able to distinguish between “good” and “bad” locations.</p>
</div>
<div class="section level2">
<h2 id="error-term-for-the-great-reed-warbler">Error term for the Great Reed Warbler<a class="anchor" aria-label="anchor" href="#error-term-for-the-great-reed-warbler"></a>
</h2>
<p>Let’s load the data and compute basic operation (see <a href="using-geopressurer.html">How to use GeoPressureR</a> for more information).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: sp</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Rafnuss/GeoPressureR" class="external-link">GeoPressureR</a></span><span class="op">)</span></span>
<span><span class="va">pam_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pam_read.html">pam_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"GeoPressureR"</span><span class="op">)</span>,</span>
<span>  crop_start <span class="op">=</span> <span class="st">"2017-06-20"</span>, crop_end <span class="op">=</span> <span class="st">"2018-05-02"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pam_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trainset_read.html">trainset_read</a></span><span class="op">(</span><span class="va">pam_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"GeoPressureR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pam_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pam_sta.html">pam_sta</a></span><span class="op">(</span><span class="va">pam_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sta_id_keep</span> <span class="op">&lt;-</span> <span class="va">pam_data</span><span class="op">$</span><span class="va">sta</span><span class="op">$</span><span class="va">sta_id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">pam_data</span><span class="op">$</span><span class="va">sta</span><span class="op">$</span><span class="va">end</span>, <span class="va">pam_data</span><span class="op">$</span><span class="va">sta</span><span class="op">$</span><span class="va">start</span>, units <span class="op">=</span> <span class="st">"hours"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">12</span><span class="op">]</span></span>
<span><span class="va">pam_data</span><span class="op">$</span><span class="va">pressure</span><span class="op">$</span><span class="va">sta_id</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">pam_data</span><span class="op">$</span><span class="va">pressure</span><span class="op">$</span><span class="va">sta_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sta_id_keep</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>We are using <a href="https://raphaelnussbaumer.com/GeoPressureServer/#description" class="external-link">the GeoPressure API</a> with the <code><a href="../reference/geopressure_map.html">geopressure_map()</a></code> function to measure the mismatch of the pressure series. Because the API can realistically return only a single map per stationary period, it aggregates the error timeseries with the Mean Squared Error (MSE), <span class="math display">\[\mathit{MSE} = \frac{1}{n}\sum_{t=1}^{n} \varepsilon[t]^2.\]</span></p>
<p>We can post-process the data to get back some basic metadata, such as the number of datapoints of each stationay period used. We also compute the position with the minimum MSE</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">raster_mse_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i_s</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pressure_maps</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># get MSE layer</span></span>
<span>  <span class="va">raster_mse_list</span><span class="op">[[</span><span class="va">i_s</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pressure_maps</span><span class="op">[[</span><span class="va">i_s</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="co"># change 0 (water) in NA</span></span>
<span>  <span class="va">raster_mse_list</span><span class="op">[[</span><span class="va">i_s</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">raster_mse_list</span><span class="op">[[</span><span class="va">i_s</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span>  <span class="co"># Acess geotiff metadata</span></span>
<span>  <span class="va">mt</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/metadata.html" class="external-link">metadata</a></span><span class="op">(</span><span class="va">pressure_maps</span><span class="op">[[</span><span class="va">i_s</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">mt</span><span class="op">$</span><span class="va">start</span> <span class="op">&lt;-</span> <span class="va">mt</span><span class="op">$</span><span class="va">extend_sample</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">mt</span><span class="op">$</span><span class="va">end</span> <span class="op">&lt;-</span> <span class="va">mt</span><span class="op">$</span><span class="va">extend_sample</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">raster_mse_list</span><span class="op">[[</span><span class="va">i_s</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, xy <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="va">mt</span><span class="op">$</span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">mt</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">sta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">sta</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">mt</span><span class="op">[</span><span class="op">-</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sta</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">sta_id</th>
<th align="right">nb_sample</th>
<th align="right">max_sample</th>
<th align="right">margin</th>
<th align="right">lon</th>
<th align="right">lat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1099</td>
<td align="right">250</td>
<td align="right">30</td>
<td align="right">16.75</td>
<td align="right">48.75</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">20</td>
<td align="right">250</td>
<td align="right">30</td>
<td align="right">-3.25</td>
<td align="right">27.75</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">14</td>
<td align="right">250</td>
<td align="right">30</td>
<td align="right">17.25</td>
<td align="right">20.25</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">16</td>
<td align="right">250</td>
<td align="right">30</td>
<td align="right">20.75</td>
<td align="right">49.25</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">522</td>
<td align="right">250</td>
<td align="right">30</td>
<td align="right">12.75</td>
<td align="right">41.25</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">14</td>
<td align="right">250</td>
<td align="right">30</td>
<td align="right">0.25</td>
<td align="right">42.75</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="gaussian-likelihood-function">Gaussian likelihood function<a class="anchor" aria-label="anchor" href="#gaussian-likelihood-function"></a>
</h2>
<p>In order to find an appropriate likelihood function, we first need to assume a distribution of the error. The sources of the errors are (1) the sensor measurement error, (2) the ERA5 reanalysis error and (3) the attitudinal movement of the bird during this time. Because we are removing the mean error, we can ignore any long-term errors (e.g., constant temporal error in ERA5 or biases in the geolocator sensor).</p>
<p>The figure below shows the error distribution at the known location of equipment and retrieval.</p>
<p><img src="Appendix_F_4.png" style="width:100.0%" alt="Histogram of the error term"> They all look close enough to a Gaussian distribution. In the case of the Great Reed Warbler, the standard deviation is around 0.5.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></code></pre></div>
<p>Therefore, assuming a gaussian distribution of our error, the <a href="https://en.wikipedia.org/wiki/Maximum_likelihood_estimation#Non-independent_variables" class="external-link">Gaussian likelkhood</a> of a multivariate normal distribution is given by <span class="math display">\[ f(\boldsymbol{\varepsilon})={\frac {1}{(2\pi)^{n/2} \sqrt{\det(\boldsymbol{\Sigma})}}}\exp \left(-\frac{1}{2} \boldsymbol{\varepsilon} \boldsymbol{\Sigma}^{-1} \boldsymbol{\varepsilon} \right).\]</span> with the vector notation <span class="math inline">\(\boldsymbol{\varepsilon }=[\varepsilon[1],\ldots,\varepsilon[n]]\)</span> and where the covariance matrix <span class="math inline">\(\boldsymbol{\Sigma}\)</span> contains the variance of two datapoints <span class="math inline">\(\boldsymbol{\Sigma}_{t_1,t_2} = \operatorname {E}[ \varepsilon[t_1] \varepsilon[t_2] ]\)</span>.</p>
</div>
<div class="section level2">
<h2 id="independance-of-errors">Independance of errors<a class="anchor" aria-label="anchor" href="#independance-of-errors"></a>
</h2>
<p>As the covariance is difficult to quantify explicitly, we can first look at the very strong assumption of independance of the error, <span class="math inline">\(\varepsilon_t \overset{i.i.d.}{\sim} \mathcal{N}(0,\sigma)\)</span>. In this case, the <a href="https://en.wikipedia.org/wiki/Maximum_likelihood_estimation#Continuous_distribution,_continuous_parameter_space" class="external-link">Gaussian likelkhood function</a> <span class="math inline">\(f_{ind}\)</span> is simply the product of the normal probability density function of each error <span class="math inline">\(\varepsilon[t]\)</span>, <span class="math display">\[ f_{ind}(\boldsymbol{\varepsilon})=\prod _{t=1}^{n}f_\mathcal{N}(\varepsilon[t])=\left({\frac {1}{2\pi \sigma ^{2}}}\right)^{n/2}\exp \left(-{\frac {\sum _{t=1}^{n}\varepsilon[t]^2}{2\sigma ^2}}\right).\]</span></p>
<p>We can re-write this equation as a function of the MSE <span class="math display">\[ f_{ind}(\boldsymbol{\varepsilon})=\left({\frac {1}{2\pi \sigma ^{2}}}\right)^{n/2}\exp \left(-n{\frac {\mathit{MSE}}{2\sigma ^2}}\right).\]</span></p>
<p>Using this equation, we can compute the probability for each stationary periods. In the code below, we define a likelihood function <code>f_prob</code> as a function of <span class="math inline">\(n\)</span>, <span class="math inline">\(\sigma\)</span> and the MSE.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_prob</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">s</span>, <span class="va">MSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">s</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span> <span class="op">*</span> <span class="va">MSE</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">/</span> <span class="va">s</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We define a function below to display the MSE and probability for 8 stationary periods based on a likelihood function. This function will be used later to compare with other likelihood function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fun_plot_prob</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f_prob</span>, <span class="va">sta</span>, <span class="va">pressure_maps</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">raster_prob_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i_s</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pressure_maps</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">sta</span><span class="op">$</span><span class="va">nb_sample</span><span class="op">[</span><span class="va">i_s</span><span class="op">]</span></span>
<span>    <span class="va">raster_prob_list</span><span class="op">[[</span><span class="va">i_s</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">f_prob</span><span class="op">(</span><span class="va">n</span>, <span class="va">s</span>, <span class="va">raster_mse_list</span><span class="op">[[</span><span class="va">i_s</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">iis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">17</span>, <span class="fl">24</span>, <span class="fl">26</span><span class="op">)</span></span>
<span>  <span class="va">sta</span><span class="op">[</span><span class="va">iis</span>, <span class="op">]</span></span>
<span>  <span class="va">dl</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfcol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">iis</span><span class="op">)</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">7</span>, <span class="fl">0</span><span class="op">)</span>, mai <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">.1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i_s</span> <span class="kw">in</span> <span class="va">iis</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">raster_mse_list</span><span class="op">[[</span><span class="va">i_s</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"MSE|i_s="</span>, <span class="va">i_s</span>, <span class="st">"|n="</span>, <span class="va">sta</span><span class="op">$</span><span class="va">nb_sample</span><span class="op">[</span><span class="va">i_s</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      horizontal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      legend.shrink <span class="op">=</span> <span class="fl">.8</span>,</span>
<span>      xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sta</span><span class="op">$</span><span class="va">lon</span><span class="op">[</span><span class="va">i_s</span><span class="op">]</span> <span class="op">-</span> <span class="va">dl</span>, <span class="va">sta</span><span class="op">$</span><span class="va">lon</span><span class="op">[</span><span class="va">i_s</span><span class="op">]</span> <span class="op">+</span> <span class="va">dl</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sta</span><span class="op">$</span><span class="va">lat</span><span class="op">[</span><span class="va">i_s</span><span class="op">]</span> <span class="op">-</span> <span class="va">dl</span>, <span class="va">sta</span><span class="op">$</span><span class="va">lat</span><span class="op">[</span><span class="va">i_s</span><span class="op">]</span> <span class="op">+</span> <span class="va">dl</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sta</span><span class="op">$</span><span class="va">lon</span><span class="op">[</span><span class="va">i_s</span><span class="op">]</span>, <span class="va">sta</span><span class="op">$</span><span class="va">lat</span><span class="op">[</span><span class="va">i_s</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i_s</span> <span class="kw">in</span> <span class="va">iis</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">raster_prob_list</span><span class="op">[[</span><span class="va">i_s</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      main <span class="op">=</span> <span class="st">"Prob"</span>,</span>
<span>      horizontal <span class="op">=</span> <span class="cn">TRUE</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, legend.shrink <span class="op">=</span> <span class="fl">.8</span>,</span>
<span>      xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sta</span><span class="op">$</span><span class="va">lon</span><span class="op">[</span><span class="va">i_s</span><span class="op">]</span> <span class="op">-</span> <span class="va">dl</span>, <span class="va">sta</span><span class="op">$</span><span class="va">lon</span><span class="op">[</span><span class="va">i_s</span><span class="op">]</span> <span class="op">+</span> <span class="va">dl</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sta</span><span class="op">$</span><span class="va">lat</span><span class="op">[</span><span class="va">i_s</span><span class="op">]</span> <span class="op">-</span> <span class="va">dl</span>, <span class="va">sta</span><span class="op">$</span><span class="va">lat</span><span class="op">[</span><span class="va">i_s</span><span class="op">]</span> <span class="op">+</span> <span class="va">dl</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sta</span><span class="op">$</span><span class="va">lon</span><span class="op">[</span><span class="va">i_s</span><span class="op">]</span>, <span class="va">sta</span><span class="op">$</span><span class="va">lat</span><span class="op">[</span><span class="va">i_s</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fun_plot_prob</span><span class="op">(</span><span class="va">f_prob</span>, <span class="va">sta</span>, <span class="va">pressure_maps</span><span class="op">)</span></span></code></pre></div>
<p><img src="probability-aggregation_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Assuming independance, the gaussian likelihood transforms the MSE into probability with narrow ranges of uncertaintie. So narrow that for long stationary period (i_s=1 and 17), the enterie map is 0.</p>
<p>This comes from the multiplication of probability assumed in the independence case (see equation above). The underlying assuming of the mulitplication operator is the <a href="https://en.wikipedia.org/wiki/Logical_conjunction" class="external-link">conjunction of probabilities</a>, where aggregating two information is done with the AND operator: <span class="math inline">\(P(A~\text{and}~B) = P(A)\times P(B)\)</span>. Only the information content overlaping every datapoint of information is kept.</p>
</div>
<div class="section level2">
<h2 id="quantifying-the-dependance-of-errors">Quantifying the dependance of errors<a class="anchor" aria-label="anchor" href="#quantifying-the-dependance-of-errors"></a>
</h2>
<p>Ploting the auto-covariance at the calibration site for all the species allow us to see a temporal pattern in the error. For most bird, we can see a clear daily fluctuation which is certainly due to the bird daily movement for commute between feeding and roosting site. The auto-covariance is approaching 0 for all birds, which is expected as we removed the mean value. However, the <a href="https://en.wikipedia.org/wiki/Variogram" class="external-link">sill</a> is reached between 6hours and 12 hours depending on birds (Hoopoe doesn’t reach it after 3 days!).</p>
<div class="figure">
<img src="Appendix_F_3.png" style="width:100.0%" alt=""><p class="caption">Auto-covariance of the error term</p>
</div>
<p>From this observation, one option would be to construct a covariance matrix based on the auto-covariance. While this would look like the cleanest way of doing it, we have two issues.</p>
<ol style="list-style-type: decimal">
<li>The first one is the absence of stationarity. Indeed, the auto-covariance amplitude (and potentially shape) is strongly influenced by the vertical displacement of the bird, which is strongly correlated with topography. For instance, the Eurasian Hoopoe has a high variance and large temporal range because it breeds at the feet of the Alps. During the rest of the year, it lives in rather flat area. Therefore, the covariance built from the breeding site would not be appropriate for the other sites.</li>
<li>The second issue has to do with the definition of our error term and the different duration of stationary period.</li>
</ol>
</div>
<div class="section level2">
<h2 id="probability-aggregation">Probability aggregation<a class="anchor" aria-label="anchor" href="#probability-aggregation"></a>
</h2>
<p>In the rest of this vignette, we will take a different angle, re-framing the problem differently and exploring other options to compute the likelihood.</p>
<p>In the field of <a href="https://link.springer.com/article/10.1007/s11004-012-9396-3" class="external-link">probability aggreation</a>, the problem of combining sources of information with overlapping/redundant content is frame as finding a pooling operator <span class="math inline">\(F\)</span> such that, <span class="math display">\[p(\textbf{x}\mid \varepsilon[1],\ldots,\varepsilon[n]) \approx F(p(\textbf{x} \mid \varepsilon[1]) ,\ldots,p(\textbf{x} \mid \varepsilon[n])),\]</span> which, with our gaussian assumption, we can written, <span class="math display">\[ F(f(\varepsilon[1]),\ldots,f(\varepsilon[n]))=F(\boldsymbol{\varepsilon})\]</span></p>
</div>
<div class="section level2">
<h2 id="introduction-to-log-linear-pooling">Introduction to Log-linear pooling<a class="anchor" aria-label="anchor" href="#introduction-to-log-linear-pooling"></a>
</h2>
<p>The most popular aggregation function is the log-linear pooling,</p>
<p><span class="math display">\[F(\boldsymbol{\varepsilon}) \propto \prod_{t=1}^n f(\varepsilon[t])^{w_t}\]</span></p>
<p>This equation also relies on the principle of conjuction of probability, but it uses a weight <span class="math inline">\(w_t\)</span> which is related to the new information brought by each additional <span class="math inline">\(\varepsilon[t]\)</span>. Formally, it can be defined by <span class="math display">\[w_t=\frac{\ln p(\varepsilon[t] \mid \boldsymbol{x},\varepsilon[1],\ldots \varepsilon[t-1])}{\ln p(\varepsilon[t] \mid \boldsymbol{x})}.\]</span> <a href="http://link.springer.com/10.1007/s11004-012-9396-3" class="external-link">Allard et al. (2012)</a> is a great resource to learn more about probability aggregation and log linear pooling.</p>
<p>The log-linear pooling aggregation simplifies to the case of Gaussian independence when <span class="math inline">\(w_t=1\)</span>. We have already explored this case earlier.</p>
<p>In the more general case, using the Gaussian probability density function formula, we can write, <span class="math display">\[f(\varepsilon[t])^{w_t} = \left({\frac {1}{2\pi \sigma ^{2}}}\right)^{w_t/2}\exp \left(-w_t{\frac {\varepsilon[t]^2}{2\sigma ^2}}\right).\]</span></p>
<p>As such, if we assume the weight to be constant <span class="math inline">\(w_t=w\)</span>, we can rewrite the pooling aggregator as <span class="math display">\[F(\boldsymbol{\varepsilon}) \propto \left({\frac {1}{2\pi \sigma ^{2}}}\right)^{\frac{wn}{2}} \exp \left(-{\frac {w}{2\sigma ^2}}\sum _{t=1}^{n}\varepsilon[t]^2\right),\]</span></p>
<p>and even write it as a function of the MSE, <span class="math display">\[F(\boldsymbol{\varepsilon}) \propto \left({\frac {1}{2\pi \sigma ^{2}}}\right)^{\frac{wn}{2}} \exp \left(-{\frac {wn}{2\sigma ^2}}\textit{MSE}\right).\]</span></p>
</div>
<div class="section level2">
<h2 id="log-linear-pooling-w1n">Log-linear pooling, <span class="math inline">\(w=1/n\)</span><a class="anchor" aria-label="anchor" href="#log-linear-pooling-w1n"></a>
</h2>
<p>An interesting case is if <span class="math inline">\(w=1/n\)</span>, so that <span class="math inline">\(\sum_t w_t=1\)</span>. This would simplify the log-linear pooling aggregator to <span class="math display">\[ F(\boldsymbol{\varepsilon})={\frac {1}{\sigma\sqrt{2\pi} }}\exp \left(-{\frac {1}{2\sigma ^2}\mathit{MSE}}\right),\]</span> which can be interpreted as the Gaussian probability distributions of the MSE. The length of the timeseries <span class="math inline">\(n\)</span> has disappeared from the equation, so that the aggregation dependence only on the mean square of the errors, regardless of how many datapoints.</p>
<p>We can try this and see the influence on the probability map.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_prob</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">s</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">w</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">n</span></span>
<span>  <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">s</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">w</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">w</span> <span class="op">*</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="va">s</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">fun_plot_prob</span><span class="op">(</span><span class="va">f_prob</span>, <span class="va">sta</span>, <span class="va">pressure_maps</span><span class="op">)</span></span></code></pre></div>
<p><img src="probability-aggregation_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>As expected from the disappearance of n, the uncertainty is now completely independent from the duration of the stationary period.</p>
<p>This is again obviously not what we want, but it shows the other extreme of the log-linear pooling.</p>
</div>
<div class="section level2">
<h2 id="log-linear-pooling-w-lognn">Log-linear pooling, <span class="math inline">\(w = \log(n)/n\)</span><a class="anchor" aria-label="anchor" href="#log-linear-pooling-w-lognn"></a>
</h2>
<p>For this study, we chose to use <span class="math inline">\(w=\frac{\log(n)}{n}\)</span>, which result in the pooling aggregation</p>
<p><span class="math display">\[F(\boldsymbol{\varepsilon}) \propto \left({\frac {1}{2\pi \sigma ^{2}}}\right)^{\frac{w\log(n)}{2}} \exp \left(-{\frac {\log(n)}{2\sigma ^2}}\textit{MSE}\right).\]</span></p>
<p>This scheme was designed to minimize the strength of <span class="math inline">\(1/n\)</span></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_prob</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">s</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span></span>
<span>  <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">s</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">w</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">w</span> <span class="op">*</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="va">s</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">fun_plot_prob</span><span class="op">(</span><span class="va">f_prob</span>, <span class="va">sta</span>, <span class="va">pressure_maps</span><span class="op">)</span></span></code></pre></div>
<p><img src="probability-aggregation_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="validation">Validation<a class="anchor" aria-label="anchor" href="#validation"></a>
</h2>
<p>Validation of uncertainty estimation is relatively difficult, especially when there are only a few datapoints and we assume that the behaviour of the bird might differ between calibration sites (equipement and retrival) and the rest of its journey.</p>
<p>In the figure below, some examples of uncertainty estimate are shown. Ideally, we want the colored area to be small (low uncertainty), but when assessing an uncertainty, we also want the red cross to fall within the colored area. That is, if the red cross is too often outside, our estimator is too confident.</p>
<p>Furthermore, the shape of the uncertainty can be strongly anisotripic (e.g., hoopoe bottom right) making the distance between the most likely point (blue) and true value (red cross) a poor measure of uncertainty.</p>
<div class="figure">
<img src="probability-aggregation-map-uncertainty.png" style="width:100.0%" alt=""><p class="caption">Uncertainty of pressure mismatch (colorscale) for the equipement period shwoing the true equipement sire (red cross) wihtin the probability map estimated and the most likely value</p>
</div>
<p>Assessing uncertainty relies on checking that that the red cross is distributed according to each uncertainty shape. A more formal way to quantifiying the uncertainty is of the quantile of the true value <span class="math inline">\(q=p(\boldsymbol{x}\leq \boldsymbol{x}_{true})\)</span>, which corresponds to the proability that the variable is less than or equal to the true value. So, if the true value belongs to the distribution, the distribution of its quantile should be uniform.</p>
<p>This can be visualize with the empirical cumulative distribution of the quantiles which should fall on the 1:1 line (like a qq-plot). The two extreme cases (<span class="math inline">\(w=1\)</span> and <span class="math inline">\(w=1/n\)</span>) show overconfidence (above the line) and underconfidence (below the line) respectively. Indeed, the distribution of quantile using the <span class="math inline">\(w=1/n\)</span> method shows a lot of quantile values between 0.9-1, which indicates that the true value is within the 90% uncertainty contour (underconfident).</p>
<p><img src="probability-aggregation-qq.png" style="width:100.0%"></p>
<p>The method chosen (<span class="math inline">\(w=\log(n)/n\)</span>) is doing better than both, but is still in general underconfident. Because the calibration the validation is performed with rather long temporal serie (equipement and retrival), one can expect that the labelisation of pressure is better/easier than for other places. Thus, it seems more appropriate to be slightly underconfident while the method is being developed.</p>
<p>The covariance aggregation scheme was implemented by computing the covariance matrix of the multi-variate Gaussian distribution. The covariance function was build using the exact on the variogram of each species. This is, in theory, the more correct method, but it looks too overconfident. Thus we didn’t use it for now.</p>
<p>Looking forward, calibration is highly dependant on the local topography and the ability of the bird to move up and down. Manual edition/labeling has also a strong impact.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Raphaël Nussbaumer, Mathieu Gravey.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
